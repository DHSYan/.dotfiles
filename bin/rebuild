#!/bin/sh

commit ()
{
    iscommit=0
    msg=0
    echo "Do you want to commit this?"
    read -r iscommit
    if [[ ${iscommit} == 'y' ]]; then
        read -r msg
        cd ~/nixos
        git add .
        git commit -m ${msg}
    fi
}

branch=$1
mode=0
mode=$2 # os for os only, home for home only

cd ~/nixos

if [ ${mode} == 'os' ]
then
    sudo nixos-rebuild switch --flake .\#${branch} --impure
    commit
    exit 0
fi

if [ ${mode} == 'home' ]
then
    home-manager switch --flake .\#tzen --impure
    commit
    exit 0 
fi

sudo nixos-rebuild switch --flake .\#${branch} --impure
home-manager switch --flake .\#tzen --impure
commit


echo "DONE"

